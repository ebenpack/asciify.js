<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
</head>
<body>
    
    <canvas id="canvas" width="300" height="300"></canvas>

    <script src="build/asciify.js"></script>
    <script>
        (function(){
            var canvas = document.getElementById('canvas');
            var ctx = canvas.getContext('2d');
            var img = document.createElement('img');

            // Prepare canvas and display instruction
            canvas.style.border = "4px dashed gray";
            ctx.textAlign="center"; 
            ctx.font="14pt Arial"; 
            ctx.fillText("Drop image files here to asciify",150,150); 

            function make_ascii(img){
                // Draw img to offscreen canvas in order to
                // get imageData array.
                canvas.width = img.width;
                canvas.height = img.height;
                canvas.style.border = "";
                var canvas2 = document.createElement('canvas');
                canvas2.width = img.width
                canvas2.height = img.height
                var ctx2 = canvas2.getContext('2d');
                ctx2.drawImage(img, 0, 0 );
                var imgData = ctx2.getImageData(0, 0, img.width, img.height);

                // Clear canvas and draw asciified image
                ctx.clearRect(0,0,canvas.width,canvas.height);
                asciify(imgData, canvas, 8, false);
            }

            // Register canvas drag 'n' drop handler
            canvas.addEventListener("dragover", function (e) {
                e.preventDefault();
            }, false);
            canvas.addEventListener("drop", function (e) {
                var files = e.dataTransfer.files;
                if (files.length > 0) {
                    var file = files[0];
                    if (typeof FileReader !== "undefined" && file.type.indexOf("image") != -1) {
                        var reader = new FileReader();
                        reader.onload = function (evt) {
                            canvas.width = img.width;
                            canvas.height = img.height;
                            img.src = evt.target.result;
                            img.onload = function(e){
                                make_ascii(img);
                            }
                        };
                    reader.readAsDataURL(file);
                    }
                }
                e.preventDefault();
            }, false);  
        })()
    </script>
</body>
</html>